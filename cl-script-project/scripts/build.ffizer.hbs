#!/usr/bin/env -S sbcl --script
; -*-Lisp-*-
(cl:require :asdf)
(asdf:require-system 'uiop)

(let* ((path (uiop:pathname-parent-directory-pathname cl:*load-truename*))
       (output-root-dir (merge-pathnames "build/**/*.fasl" path)))
  (asdf:initialize-output-translations
   `(:output-translations (:here ,output-root-dir)
     :disable-cache :ignore-inherited-configuration))
  (asdf:initialize-source-registry
   `(:source-registry
     :ignore-inherited-configuration
     (:directory ,path)
     (:tree ,(merge-pathnames "peru-managed-systems/" path))
     (:tree ,(merge-pathnames "systems/" path)))))

(asdf:require-system :{{ project }})
(asdf:require-system :{{ project }}/cli)

(asdf:make :{{ project }}/cli)
(quit)
